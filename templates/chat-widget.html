<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Empleabot Chat</title>
    <link href="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/chat-bubble.css') }}" rel="stylesheet">
</head>
<body>
    <div class="chat-widget minimized" id="chatWidget">
        <div class="chat-header">
            <h3>
                <i data-feather="message-circle" class="me-2"></i>
                Empleabot
            </h3>
            <div class="chat-controls">
                <button class="chat-control-btn" id="minimizeBtn" title="Minimizar">
                    <i data-feather="minimize-2"></i>
                </button>
                <button class="chat-control-btn" id="maximizeBtn" title="Maximizar">
                    <i data-feather="maximize-2"></i>
                </button>
                <button class="chat-control-btn" id="closeBtn" title="Cerrar">
                    <i data-feather="x"></i>
                </button>
            </div>
        </div>
        
        <div class="chat-body">
            <div class="chat-messages" id="chatMessages">
                <div class="message bot-message">
                    ¡Hola! Soy tu asistente virtual de empleabilidad. ¿En qué puedo ayudarte hoy?
                </div>
            </div>

            <div class="chat-input">
                <form id="chatForm" class="input-container">
                    <button type="button" class="file-upload" id="fileUploadBtn" title="Adjuntar archivo">
                        <i data-feather="paperclip"></i>
                        <input type="file" id="fileInput" accept=".pdf,.doc,.docx" hidden>
                    </button>
                    <input type="text" class="message-input" id="messageInput" placeholder="Escribe tu pregunta aquí..." autocomplete="off">
                    <button type="submit" class="send-button" id="sendBtn">
                        <i data-feather="send"></i>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize Feather icons
            feather.replace();

            const chatWidget = document.getElementById('chatWidget');
            const minimizeBtn = document.getElementById('minimizeBtn');
            const maximizeBtn = document.getElementById('maximizeBtn');
            const closeBtn = document.getElementById('closeBtn');
            const chatForm = document.getElementById('chatForm');
            const messageInput = document.getElementById('messageInput');
            const chatMessages = document.getElementById('chatMessages');
            const fileInput = document.getElementById('fileInput');
            const fileUploadBtn = document.getElementById('fileUploadBtn');
            const suggestedQuestions = document.querySelectorAll('.suggested-question');

            // Handle main action buttons
            const actionButtons = document.querySelectorAll('.action-button');
            actionButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const title = button.querySelector('h3').textContent;
                    const description = button.querySelector('p').textContent;
                    const message = `${title}: ${description}`;
                    messageInput.value = message;
                    messageInput.focus();
                    // Show chat widget if it's hidden
                    chatWidget.style.display = 'block';
                    // Auto submit after a brief delay
                    setTimeout(() => {
                        chatForm.dispatchEvent(new Event('submit'));
                    }, 100);
                });
            });

            // Toggle minimize/maximize
            minimizeBtn.addEventListener('click', () => {
                chatWidget.classList.add('minimized');
                chatWidget.classList.remove('maximized');
            });

            maximizeBtn.addEventListener('click', () => {
                chatWidget.classList.remove('minimized');
                chatWidget.classList.add('maximized');
            });

            // Close chat
            closeBtn.addEventListener('click', () => {
                chatWidget.style.display = 'none';
            });

            // Handle file upload
            fileUploadBtn.addEventListener('click', () => {
                fileInput.click();
            });

            fileInput.addEventListener('change', () => {
                if (fileInput.files.length > 0) {
                    const fileName = fileInput.files[0].name;
                    addMessage(`Archivo adjuntado: ${fileName}`, 'user-message');
                    // Add bot response about file upload
                    setTimeout(() => {
                        addMessage('He recibido tu archivo. ¿En qué área específica te gustaría que me enfoque para ayudarte?', 'bot-message');
                    }, 500);
                }
            });

            // Handle form submission
            chatForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const message = messageInput.value.trim();
                if (message) {
                    addMessage(message, 'user-message');
                    messageInput.value = '';
                    
                    // Simulate bot response
                    setTimeout(() => {
                        let botResponse = 'Entiendo. ¿Podrías proporcionarme más detalles sobre tu solicitud?';
                        
                        // Custom responses based on message content
                        if (message.toLowerCase().includes('cv')) {
                            botResponse = 'Para ayudarte con tu CV, ¿podrías adjuntar tu CV actual o decirme específicamente qué aspecto te gustaría mejorar?';
                        } else if (message.toLowerCase().includes('entrevista')) {
                            botResponse = 'Te puedo ayudar con consejos para entrevistas. ¿Es para algún sector específico o tipo de posición en particular?';
                        } else if (message.toLowerCase().includes('curso')) {
                            botResponse = '¿En qué área te gustaría desarrollarte? Esto me ayudará a recomendarte los cursos más relevantes.';
                        }
                        
                        addMessage(botResponse, 'bot-message');
                    }, 1000);
                }
            });

            // Handle suggested questions with auto-submit
            suggestedQuestions.forEach(button => {
                button.addEventListener('click', () => {
                    const question = button.textContent;
                    messageInput.value = question;
                    messageInput.focus();
                    // Auto submit after a brief delay
                    setTimeout(() => {
                        chatForm.dispatchEvent(new Event('submit'));
                    }, 100);
                });
            });

            // Helper function to add messages
            function addMessage(text, className) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${className}`;
                messageDiv.textContent = text;
                chatMessages.appendChild(messageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
        });
    </script>
</body>
</html> 